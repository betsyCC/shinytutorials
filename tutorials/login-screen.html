<!DOCTYPE html>
<html>
<head lang="en-US">
	<!-- META -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="In this tutorial, we will build a learn how to make a login screen.">
	<meta name="keywords" content="R, rstudio, shiny, tutorials, shinyapps, shiny apps">
	<meta property="og:title" content="dcrData / Shiny Tutorials / Login Screen">
	<meta propert="og:description" content="In this tutorial, we will build a learn how to make a login screen.">
	<meta property="twitter:title" content="dcrData / Shiny Tutorials / Login Screen">
	<meta propert="twitter:description" content="In this tutorial, we will build a learn how to make a login screen.">
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,600" rel="stylesheet">
	<!-- <link rel="stylesheet" type="text/css" href="../css/styles.css"> -->
	<link rel="stylesheet" type="text/css" href="../css/styles.min.css">
	<title>dcrData | Shiny App Tutorials</title>
</head>
<body>
	<div class="block-titlebar">
		<div class="block-titlebar-content block-grid grid-25-50-25">
			<div class="titlebar-item align-left">
				<a href="../index.html">
					<svg height="20" width="20" role="img" viewBox="0 0 28 18" xmlns="http://www.w3.org/2000/svg">
						<path stroke="#252525" stroke-width="2px" fill="#252525" d="M20,0 L 5,10, L 20,20 Z"/>
					</svg>
				</a>
			</div>
			<div class="titlebar-item align-center">
			</div>
			<div class="titlebar-item align-right">
				<a href="https://www.twitter.com/dcruvolo" aria-label="follow me on twitter">
					<svg height="30" width="30" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"/></svg>
				</a>
				<a href="https://github.com/davidruvolo51/shinytutorials" aria-label="check out the code for the tutorials over on github">
					<svg height="30" width="30" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
				</a>
			</div>
		</div>
	</div>
	<div class="block-tutorial">
		<div class="block-tutorial-content">
			<div class="tutorial-header">
				<h1>Login Screen</h1>
				<h2>Building a Simple Password Protected Shiny App</h2>
			</div>
			<h2>Contents</h2>
			<section class="toc" aria-label="table of contents">
				<ol>
					<li><a href="#login-screen-about">Why would I need a login screen?</a></li>
					<li><a href="#login-screen-work">How does the login screen work?</a></li>
					<li><a href="#login-screen-thoughts">What else should I know before using this?</li>
					<li><a href="#login-screen-run">How do I run the demo?</a></li>
				</ol>
			</section>
			<section id="login-screen-about">
				<h2>Why would I need this?</h2>
				<p>You probably do not need and you should use other well-defined methods than this one. The professional shinyapps.io account has a privacy settings that allows you to make apps private, but it does require a subscription. If you wanted to create an 'protected' shiny app this could be a potential solution that was inspired by a few SO posts. If you setting up your own shiny server, there are tutorials and guides available for protecting your applications using better methods.</p>
			</section>
			<section id="login-screen-work">
				<h2>How does the app work?</h2>
				<p>The way to visualize the UI structure is that there are three different 'screens': 1) login, 2) standard user UI, and 3) admin UI. When the user logs in, the username/password input is matched to the user account dataset. If the credentials do not match, then an error message is displayed. If successful, the credentials are matched to the corresponding account type (standard or admin), which renders the corresponding UI.</p>
				<h3>Create a single line ui.R file.</h3>
				<p>This shiny app works by rending the UI on the server side on successful login. The ui.R file looks like this.</p>
				<pre><code>
					<span class="object">ui</span> <- <span class="function">uiOutput</span>(<span class="value">"page"</span>)
				</code></pre>
				<h3>Build the base <strong>ui1()</strong></h3>
				<p>The base ui <strong>ui1()</strong> contains the structure and the styling for the login screen. The login screen will have a short greeting and text inputs for username and password. The function, <strong>good_time</strong> returns a time of day greeting (e.g., 'good morning' or 'good evening'; see R file). Beneath the input box, we will also create a <strong>uiOutput</strong> for the error message, which is described in the next step.</p>
				<pre><code>
				<span class="comment"># set ui1</span>
				<span class="object">ui1</span> <- <span class="function">function</span>(){
						<span class="function">tagList</span>(
									<span class="function">div</span>(<span class="argument">id</span>=<span class="value">"container"</span>,
											<span class="function">div</span>(<span class="argument">id</span> = <span class="value">"login"</span>,

													<span class="comment"># make login panel</span>
													<span class="function">wellPanel</span>(id=<span class="value">"well"</span>,
															<span class="function">HTML</span>(<span class="function">paste0</span>('<span class="value">&lt;h2&gt;Hello, '</span>, <span class="function">good_time()</span>,<span class="value">'&lt;/h2&gt;&lt;br&gt;&lt;h3&gt;Sign in to your account.&lt;/h3&gt;'</span>)),
															<span class="function">br()</span>,
															<span class="function">textInput</span>(<span class="value">"userName"</span>,<span class="value">"Username"</span>),
															<span class="function">passwordInput</span>(<span class="value">"passwd"</span>, <span class="value">"Password"</span>),

															<span class="comment"># button</span>
															<span class="function">actionButton</span>(<span class="value">"Login"</span>,<span class="value">"Log in"</span>)
													),

													<span class="comment"># login error message</span>
													<span class="function">uiOutput</span>(<span class="value">"message"</span>)
											)
									),

									<span class="comment"># css here</span>
									...
						)
				}
				</code></pre>
				<h3>Define the user accounts</h3>
				<p>Create an object with allowed usernames and passwords. You can use email addresses if that's easier and also assign initial passwords. You can also generate random character strings using the <strong>stri_rand_strings()</strong> function from the <strong>stringi</strong> package.</p>
				<pre><code>
				<span class="comment"># example accounts</span>
				| type     | Username       | password      |
				---------------------------------------------
				| standard | brooke7901     |  somePassword |
				| admin    | shirley2131    |  somePassword |
				| admin    | lindsey5876    |  somePassword |

				<span class="comment"># Build data.frame of user accounts</span>
				<span class="object">users</span> <- <span class="function">data.frame</span>(
						<span class="argument">"User"</span>=c(<span class="value">"brooke7901"</span>,<span class="value">"shirley2131"</span>,<span class="value">"lindsey5876"</span>),
						<span class="argument">"Password"</span>=c(<span class="value">"somePassword"</span>,<span class="value">"somePassword"</span>,<span class="value">"somePassword"</span>),
						<span class="argument">stringsAsFactors</span>=<span class="logical">FALSE</span>
				)
				</code></pre>
				<p>Make sure the user account information are stored separately and kept secure. It would best to consult someone who is familiar with security if you were planning to host on the web (Ideally, you would want to use a well defined tool).</p>
				<h3>Create an object that will handle the login status</h3>
				<p>Over on the shiny server code, let's create an object that will handle the user login status (i.e., is the user logged in? yes or no?). Outside the server code, we create the object <strong>Logged</strong> and set it to <strong>FALSE</strong> (where <strong>FALSE</strong> means not logged in).</p>
				<pre><code>
					<span class="comment"># login status</span>
					<span class="object">Logged</span> = <span class="logical">FALSE</span>
				</code></pre>
				<p>We also place this into a <strong>reactiveValue</strong> object.</p>
				<pre><code>
					<span class="comment"># reactive values for login status</span>
					<span class="object">USER</span> <- <span class="function">reactiveValues</span>(<span class="argument">Logged</span> = <span class="value">Logged</span>)
				</code></pre>
				<h3>Set Login Screen ObserveEvent</h3>
				<p>There is one <strong>observeEvent</strong> that checks the user inputs. This event is triggered when the login button is clicked.</p>
				<p>In the first block (# render error message), the user input is checked against the list registered users. If the credentials supplied does not match any of the existing accounts, then it displays an error message. The input data is matched with existing accounts by using <strong>grep</strong> to scan through the data for matching username and password, and then returns the length of the data. The return value is numeric and can only have the values of 0 or 1 where 0 equals no match and 1 equals a sucessful match. Both username and password have to return a value of 1 in order to move on.</p>
				<p>The second block (#check input) uses the same method except that when credentials are successfully matched, it sets the object <strong>Logged</strong> to TRUE. <strong>Logged</strong> is the current status of user where <strong>TRUE</strong> equals logged in and <strong>FALSE</strong> equals logged out.</p>
				<pre><code>
				<span class="comment"># On login btn click</span>
				<span class="function">observeEvent</span>(<span class="value">input$Login</span>,{

							<span class="comment"># render error message</span>
							<span class="object">output$message</span> <- <span class="function">renderUI</span>({
									<span class="function">if</span>(<span class="function">!is.null</span>(<span class="value">input$Login</span>)){
											<span class="object">my_username</span> <- <span class="function">length</span>(<span class="object">users$User</span>[<span class="function">grep</span>(<span class="argument">pattern</span> = <span class="value">input$userName</span>, <span class="argument">x</span> = <span class="value">users$User</span>)])
											<span class="object">my_password</span> <- <span class="function">length</span>(<span class="object">users$User</span>[<span class="function">grep</span>(<span class="argument">pattern</span> = <span class="value">input$passwd</span>, <span class="argument">x</span> = <span class="value">users$Password</span>)])
											<span class="function">if</span>(<span class="object">input$Login</span> > 0){
													<span class="function">if</span>(<span class="object">my_username</span> < 1 ||  <span class="object">my_password</span> < 1){
															<span class="function">HTML</span>(<span class="value">&lt;div id='error-box'&gt;Sorry, that's not the right username or password. Please, try again. &lt;/div&gt;"</span>)
													}
											}
									}
							})

							<span class="comment"># CHECK INPUT</span>
							<span class="function">if</span>(<span class="object">USER$Logged</span> == <span class="logical">FALSE</span>) {
									<span class="function">if</span>(<span class="function">!is.null</span>(<span class="value">input$Login</span>)) {
											<span class="function">if</span>(<span class="object">input$Login</span> > 0) {
												<span class="object">Username</span> <- <span class="function">isolate</span>(<span class="object">input$userName</span>)
												<span class="object">Password</span> <- <span class="function">isolate</span>(<span class="object">input$passwd</span>)
												<span class="object">Id.username</span> <- <span class="function">which</span>(<span class="object">users$User</span> == <span class="object">Username</span>)
												<span class="object">Id.password</span> <- <span class="function">which</span>(<span class="object">users$Password</span> == <span class="object">Password</span>)
													<span class="function">if</span>(<span class="function">length</span>(<span class="object">Id.username</span>) > 0 & <span class="function">length</span>(<span class="object">Id.password</span>) > 0) {
															<span class="function">if</span>(<span class="object">Id.username</span> %in% <span class="object">Id.password</span>) {
																	<span class="object">USER$Logged</span> <- <span class="logical">TRUE</span>
															}
													}
											}
									}
							}
					})
				</code></pre>
				<h3>Rendering the UI When Logged = TRUE</h3>
				<p>Rendering the UI is fairly straightforward at this point and can be triggered by a conditional statement. The following code demonstrates how the object <strong>logged</strong> (as defined in the previous steps) is used to render the UI.</p>
				<p>If the value of <strong>logged</strong> == <strong>FALSE</strong>, then render the UI object <strong>ui1</strong> that was defined in step 2. Since the initial value of <strong>logged</strong> is <strong>FALSE</strong>, the login ui will render by default (e.g., on app load).</p>
				<pre><code>
				<span class="comment"># render ui based on admin rights</span>
				<span class="package">observe</span>({
						<span class="comment"># when logged = FALSE</span>
						<span class="function">if</span> (<span class="object">USER$Logged</span> == <span class="logical">FALSE</span>) {
									<span class="object">output$page</span> <- <span class="function">renderUI</span>({
										<span class="function">div</span>(<span class="argument">class</span>=<span class="value">"outer"</span>,<span class="function">do.call</span>(<span class="function">bootstrapPage</span>,<span class="function">c</span>(<span class="value">""</span>,<span class="function">ui1()</span>)))
								})
						}

						<span class="comment"># Render UI by user type when logged = TRUE</span>
						<span class="function">if</span>(<span class="object">USER$Logged</span> == <span class="logical">TRUE</span>){
			
								<span class="comment"># get the current user's authorization level</span>
								<span class="object">user_log</span> <- <span class="function">toupper</span>(<span class="value">input$userName</span>)
				
								<span class="comment"># if admin</span>
								<span class="function">if</span>(<span class="object">user_log</span> == <span class="value">"ADMIN"</span>){
										<span class="object">output$page</span> <- <span class="function">renderUI</span>({
												<span class="function">fluidPage</span>(
														<span class="comment">...</span>
												)
										})
								}

								<span class="comment"># if standard user</span>
								<span class="function">else</span>{
										<span class="object">output$page</span> <- <span class="function">renderUI</span>({
													<span class="function">fluidPage</span>(
															<span class="comment">...</span>
													)
										})
								}
						}
				})
				</code></pre>
				<p>Setting admin rights is optional. If you do not want it, restructure the <strong>logged = TRUE</strong> section as written below.</p>
				<pre><code>
				<span class="comment"># render ui without admin rights</span>
				<span class="package">observe</span>({
						<span class="comment"># when logged = FALSE</span>
						<span class="function">if</span> (<span class="object">USER$Logged</span> == <span class="logical">FALSE</span>) {
									<span class="object">output$page</span> <- <span class="function">renderUI</span>({
											<span class="function">div</span>(<span class="argument">class</span>=<span class="value">"outer"</span>,<span class="function">do.call</span>(<span class="function">bootstrapPage</span>,<span class="function">c</span>(<span class="value">""</span>,<span class="function">ui1()</span>)))
									})
						} 

						<span class="comment"># Render UI by user type when logged = TRUE</span>
						<span class="function">if</span>(<span class="object">USER$Logged</span> == <span class="logical">TRUE</span>){
								<span class="object">output$page</span> <- <span class="function">renderUI</span>({
											<span class="function">fluidPage</span>(
													<span class="comment">...</span>
								)
						}
				})

				</code></pre>
				<p>You may replace <strong>fluidPage</strong> with any type of shiny ui layout (e.g., <strong>sidebarLayout</strong>, <strong>tabsetPanel</strong>, etc.). See <a href="https://shiny.rstudio.com/articles/layout-guide.html" aria-label="read more about layouts in shiny">shiny.rstudio.com/articles/layout-guide.html</a> for more information.</p>
			</section>
		<section id="login-screen-thoughts">
			<h2>Thoughts</h2>
			<p>I've used this method to create a project management tool to manage daily activities and tasks. It was hosted on department servers and I added this login screen only those with an account could view it. In the live app, the account data was stored separately. I don't see much use for it elsewhere and it was a pain to setup. The server side can get messy pretty quickly, and we haven't added any code to build charts or other elements. I wouldn't really use this if you have sensitive information you'd like to protect.</p>
			<p>Alternatively, you can use the shiny package <a href="https://paul.rbind.io/2018/11/04/introducing-shinyauthr/" aria-label="learn more about the shiny author packge">shinyauthr</a>.</p>
		</section>
		<section id="login-screen-run">
			<h2>How can I run this app?</h2>
			<p>The source code is available on <a href="https://github.com/davidruvolo51/shinyAppTutorials/tree/master/Login-Screen" aria-label="view the full code on github.com">github</a>. Alternatively, you can run the demo in R using the following code. Use one of the following accounts to login.</p>
			<pre><code>
				<span class="comment"># Run in R/Rstudio</span>
				<span class="function">install.packages</span>("<span class="package">shiny</span>")
				shiny::<span class="function">runGitHub</span>(<span class="argument">repo</span>=<span class="value">"shinyAppTutorials"</span>, <span class="argument">username</span>=<span class="value">"davidruvolo51"</span>, <span class="argument">subdir</span>=<span class="value">"Login-Screen"</span>)

				<span class="comment"># sample accounts</span>
				| type     | Username | password |
				----------------------------------
				| standard | user     | password |
				| standard | test     | test     |
				| admin    | admin    | admin    |
			</code></pre>
		</section>
	</div>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-76117337-11"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76117337-11');
</script>
</body>
</html>